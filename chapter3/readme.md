# Fitting Deformable Mesh models to Raw Point Clouds
討論一個使用可變形網格模型來擬合可能來自原始深度相機傳感結果的原始點雲觀測的項目

來自深度相機的原始點雲觀測通常採用點雲格式，沒有任何有關這些點如何連接的信息；


因此，從點雲重建表面信息通常是 3D 數據處理流程中的標準步驟。 
存在大量關於從點雲進行 3D 表面重建的現有技術文獻，例如泊松重建。 使用可變形網格模型進行表面重建也是常用的方法之一。 
本章討論的點雲變形網格模型擬合方法是一種實用且簡單的基線方法。

## Fitting meshs to point clouds -- the problem
現實世界的深度相機，例如激光雷達、飛行時間相機和立體視覺相機，通常輸出深度圖像或點雲。 
例如，在飛行時間相機的情況下，調製光線從相機投射到世界，並且每個像素處的深度是根據在像素處接收到的反射光線的相位來測量的。 
因此，在每個像素處，我們通常可以獲得一次深度測量和一次反射光幅度測量。 然而，除了採樣的深度信息之外，我們通常沒有表面的直接測量。 例如，我們無法直接測量表面的光滑度或標準。

## Formulating a deformable mesh fitting problem into an optimizetion problem
在本節中，我們將討論如何將網格擬合問題轉化為優化問題。 這裡的一個關鍵觀察是，諸如行人之類的物體表面總是可以連續變形為球體。 因此，我們要採取的方法將從球體表面開始，使表面變形以最小化成本函數。

為了將網格擬合到點雲，我們首先從網格模型中隨機採樣一些點，然後優化網格模型採樣點與輸入點雲之間的倒角距離。 隨機採樣是通過 pytorch3d.ops.sample_points_from_ meshes 實現的。 同樣，我們可以從 pytorch3d.ops 計算反向傳播的梯度。 來自網格的樣本點。
現在，我們有了優化問題的基本版本。 然而，我們可能仍然需要一些損失函數來對該問題進行正則化。 我們將在下一節中深入探討這些問題。

## Loss function for regularization
問題在於可能存在多個可以很好地擬合同一點雲的網格模型。 這些擬合良好的網格模型可能包括一些遠離平滑網格的網格模型。


另一方面，我們通常對行人有先驗知識。 例如，行人的表面通常是光滑的，表面規範也是光滑的。 因此，即使非平滑網格在倒角距離方面接近輸入點雲，我們也有一定程度的置信度知道它遠離ground truth。

在接下來的幾小節中，我們將討論幾個這樣的損失函數，包括以下內容：
- 網格拉普拉斯平滑損失 Mesh Laplacian smoothing loss
- 網格法線一致性損失 Mesh normal consistency loss
- 網格邊緣損失 Mesh edge loss

### Mesh Laplacian smoothing loss 
在前面的定義中，第 i 個頂點的拉普拉斯算子只是差值之和，其中每個差值是當前頂點的坐標與相鄰頂點的坐標之間的差值。

拉普拉斯算子是平滑度的度量。 如果第 i 個頂點及其鄰居都位於一個平面內，則拉普拉斯算子應該為零。 在這裡，我們使用拉普拉斯算子的統一版本，其中每個鄰居對總和的貢獻是同等加權的。 拉普拉斯算子有更複雜的版本，其中前面的貢獻根據各種方案進行加權。
本質上，在優化中包含此損失函數將導致更平滑的解決方案。 網格拉普拉斯平滑損失的一種實現（包括除統一版本之外的多個其他版本）可以在 pytorch3d.loss.mesh_laplacian_smoothing 中找到。 再次啟用反向傳播的梯度計算。

### Mesh normal consistency loss
網格法線一致性損失是用於懲罰網格上相鄰法線向量之間的距離的損失函數。 可以在 pytorch3d.loss.mesh_normal_consistency 找到一種實現。

### Mesh edge loss
網格邊緣損失用於懲罰網格中的長邊緣。 例如，在本章我們考慮的網格模型擬合問題中，我們希望最終得到一個解，使得得到的網格模型能夠均勻地擬合輸入點雲。 換句話說，點雲的每個局部區域都被網格的小三角形覆蓋。 否則，網格模型無法捕獲緩慢變化的表面的精細細節，這意味著該模型可能不那麼準確或不值得信賴。
通過將網格邊緣損失包含在目標函數中可以輕鬆避免上述問題。 網格邊緣損失本質上是網格中所有邊緣長度的總和。 網格邊緣損失的一種實現可以在 pytorch3d.loss.mesh_edge_loss 中找到。
現在，我們已經涵蓋了該網格擬合問題的所有概念和數學。 接下來，讓我們深入探討如何使用 Python 和 PyTorch3D 對問題進行編碼。

## Implementing the mesh fitting with Pytorch3D
> mesh_fitting.py